<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin Dashboard — Ann’s Ventures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364; --accent:#f9d342; --accent-hover:#ffd700; --text:#fff; --muted:#cfd8dc; --card:rgba(255,255,255,0.08); --shadow:0 10px 30px rgba(0,0,0,0.35); }
    * { box-sizing: border-box; }
    body { font-family:'Poppins',sans-serif; margin:0; color:var(--text); background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3)); }
    header { text-align:center; padding:2rem 1rem; }
    header img { max-width:120px; margin-bottom:1rem; cursor:pointer; }
    h1 { margin:0; color:var(--accent); }
    main { max-width:1100px; margin:0 auto; padding:1rem; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
    .panel { background:var(--card); border-radius:16px; padding:1rem; box-shadow:var(--shadow); backdrop-filter:blur(6px); }
    label { display:block; margin-top:0.75rem; }
    input { width:100%; padding:0.6rem; border-radius:8px; border:none; margin-top:0.25rem; }
    .btn { margin-top:0.75rem; padding:0.6rem 1rem; border:none; border-radius:8px; font-weight:600; background:var(--accent); color:#000; cursor:pointer; transition:background 0.25s ease, transform 0.2s ease; }
    .btn:hover { background:var(--accent-hover); transform: translateY(-2px); }
    ul { list-style:none; padding:0; margin:0; }
    li { display:flex; justify-content:space-between; align-items:center; gap:0.75rem; padding:0.6rem 0; border-bottom:1px solid rgba(255,255,255,0.08); }
    .actions { display:flex; gap:0.5rem; }
    .muted { color:var(--muted); }
    .status { min-height:1.25rem; margin-top:0.5rem; }
    footer { text-align:center; padding:1.5rem; margin-top:2rem; background:rgba(0,0,0,0.35); }
    footer a { color:var(--accent); text-decoration:none; margin:0 0.5rem; }
    @media (max-width:900px){ .grid { grid-template-columns:1fr; } }
    /* Modal */
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.3s ease; }
    .modal.active { opacity:1; pointer-events:auto; }
    .modal-content { background:var(--card); padding:2rem; border-radius:16px; box-shadow:var(--shadow); width:90%; max-width:420px; }
    .modal h2 { color:var(--accent); margin-bottom:1rem; }
    .btn-secondary { background:#333; color:#fff; }
    .btn-secondary:hover { background:#444; }
  </style>
</head>
<body>
  <header>
    <a href="index.html"><img src="logo.png" alt="Ann’s Ventures Logo"></a>
    <h1>Admin Dashboard</h1>
    <p id="welcome" class="muted"></p>
  </header>

  <main>
    <div class="grid">
      <section class="panel">
        <h2 style="color:var(--accent);">Add Product</h2>
        <form id="productForm" novalidate>
          <label>Product Name</label>
          <input type="text" id="name" placeholder="e.g., Premium Rice" required>
          <label>Price (₦)</label>
          <input type="number" id="price" min="1" step="1" placeholder="e.g., 2500" required>
          <button id="addBtn" class="btn" type="submit">Add Product</button>
        </form>
        <div id="status" class="status muted"></div>
        <button id="logoutBtn" class="btn btn-secondary" style="margin-top:0.5rem;">Logout</button>
      </section>

      <section class="panel">
        <h2 style="color:var(--accent);">Product List</h2>
        <ul id="productList"></ul>
      </section>
    </div>
  </main>

  <footer>
    <a href="index.html">Storefront</a> • 
    <a href="orders.html">Orders</a>
  </footer>

  <!-- Edit Modal -->
  <div id="editModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h2>Edit Product</h2>
      <form id="editForm" novalidate>
        <label>Product Name</label>
        <input type="text" id="editName" required>
        <label>Price (₦)</label>
        <input type="number" id="editPrice" min="1" step="1" required>
        <div class="actions" style="margin-top:0.75rem;">
          <button class="btn" type="submit">Save Changes</button>
          <button class="btn btn-secondary" type="button" id="cancelEdit">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase config (your provided object)
    const firebaseConfig = {
      apiKey: "AIzaSyB8hFcULiR_DtQbHvSswwgUsvCuM0w7z50",
      authDomain: "anns-venture.firebaseapp.com",
      projectId: "anns-venture",
      storageBucket: "anns-venture.firebasestorage.app",
      messagingSenderId: "699590854312",
      appId: "1:699590854312:web:4a88d59ef45563bbf1649d",
      measurementId: "G-X2RCRHZVJ0"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const formatNaira = (value) =>
      new Intl.NumberFormat("en-NG", { style: "currency", currency: "NGN" }).format(Number(value || 0));

    onAuthStateChanged(auth, user => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        document.getElementById("welcome").textContent = `Logged in as ${user.email}`;
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("productForm");
      const productList = document.getElementById("productList");
      const statusEl = document.getElementById("status");
      const logoutBtn = document.getElementById("logoutBtn");

      const editModal = document.getElementById("editModal");
      const editForm = document.getElementById("editForm");
      const editName = document.getElementById("editName");
      const editPrice = document.getElementById("editPrice");
      const cancelEdit = document.getElementById("cancelEdit");

      let currentEditId = null;

      logoutBtn.onclick = async () => {
        await signOut(auth);
        window.location.href = "login.html";
      };

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        statusEl.textContent = "";
        const name = document.getElementById("name").value.trim();
        const price = Number(document.getElementById("price").value);

        if (!name || isNaN(price) || price <= 0) {
          statusEl.innerHTML = `<span class="error">Enter a valid product name and price.</span>`;
          return;
        }

        try {
          document.getElementById("addBtn").disabled = true;
          await addDoc(collection(db, "products"), { name, price });
          form.reset();
          await loadProducts();
          statusEl.textContent = "Product added.";
        } catch (err) {
          statusEl.innerHTML = `<span class="error">Failed to add product: ${err.message}</span>`;
        } finally {
          document.getElementById("addBtn").disabled = false;
        }
      });

      async function loadProducts() {
        productList.innerHTML = "";
        const querySnapshot = await getDocs(collection(db, "products"));
        if (querySnapshot.empty) {
          productList.innerHTML = `<li class="muted">No products yet.</li>`;
        } else {
          querySnapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const li = document.createElement("li");
            li.innerHTML = `
              <span>${data.name} — ${formatNaira(data.price)}</span>
              <div class="actions">
                <button class="btn btn-secondary" data-action="edit">Edit</button>
                <button class="btn" data-action="delete">Delete</button>
              </div>
            `;

            // Edit handler
            li.querySelector('[data-action="edit"]').onclick = () => {
              currentEditId = docSnap.id;
              editName.value = data.name;
              editPrice.value = Number(data.price);
              openEditModal();
            };

            // Delete handler
            li.querySelector('[data-action="delete"]').onclick = async () => {
              try {
                await deleteDoc(doc(db, "products", docSnap.id));
                await loadProducts();
              } catch (err) {
                statusEl.innerHTML = `<span class="error">Delete failed: ${err.message}</span>`;
              }
            };

            productList.appendChild(li);
          });
        }
      }

      // Modal controls
      function openEditModal() {
        editModal.classList.add("active");
        editModal.setAttribute("aria-hidden", "false");
      }
      function closeEditModal() {
        editModal.classList.remove("active");
        editModal.setAttribute("aria-hidden", "true");
        currentEditId = null;
        editForm.reset();
      }

      cancelEdit.onclick = closeEditModal;

      editForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!currentEditId) return;
        const name = editName.value.trim();
        const price = Number(editPrice.value);
        if (!name || isNaN(price) || price <= 0) return;

        try {
          await updateDoc(doc(db, "products", currentEditId), { name, price });
          closeEditModal();
          await loadProducts();
          statusEl.textContent = "Product updated.";
        } catch (err) {
          statusEl.innerHTML = `<span class="error">Update failed: ${err.message}</span>`;
        }
      });

      // Initial load
      loadProducts();
    });
  </script>
</body>
</html>
